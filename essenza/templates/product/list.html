{% extends "base.html" %} {% block title %}Lista de Productos · Essenza
{%endblock %} {% block content %} {% load static %}
<style>
  /* Styles scoped to .list-page so they don't override base header/navbar */
  .list-page * {
    box-sizing: border-box;
  }
  .list-page {
    background-color: #faf7f2;
    font-family: "Segoe UI", Arial, sans-serif;
    color: #333;
    padding: 20px 0;
  }
  .list-page .container {
    /* Contenedor principal centrado para el contenido */
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    background: transparent;
  }

  .filters {
    max-width: 1100px;
    margin: 25px auto 0 auto;
    display: flex;
    margin-bottom: 30px;
  }

  h1 {
    color: #c06b3e;
    text-align: center;
    margin-bottom: 30px;
    font-size: 32px;
  }
  .header-actions {
    text-align: center;
    margin-bottom: 30px;
  }
  .btn-create {
    display: inline-block;
    padding: 12px 30px;
    background-color: #c06b3e;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-weight: bold;
    transition: background-color 0.3s;
  }
  .btn-create:hover {
    background-color: #a35a34;
  }
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
  }
  .product-card {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  .product-image {
    width: 100%;
    height: 200px;
    object-fit: contain;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #999;
    font-size: 14px;
  }
  .product-image img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
  .product-info {
    padding: 15px;
    padding-bottom: 0;
  }
  .product-name {
    font-size: 18px;
    font-weight: bold;
    color: #c06b3e;
    margin-bottom: 8px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .product-brand {
    font-size: 14px;
    color: #666;
    margin-bottom: 8px;
  }
  .product-price {
    font-size: 20px;
    font-weight: bold;
    color: #333;
    margin-bottom: 8px;
  }
  .product-actions {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
  }
  .product-stock {
    font-weight: 600;
    font-size: 16px;
  }
  .btn-small {
    flex: 1;
    padding: 8px 0px;
    text-decoration: none;
    border-radius: 4px;
    text-align: center;
    font-size: 16px;
    font-weight: bold;
    transition: opacity 0.3s;
  }

  /* === ESTILO DE BOTÓN === */
  .btn-detail {
    background-color: #c06b3e;
    color: white;
  }
  .btn-detail:hover {
    opacity: 0.8;
  }
  .btn-edit {
    background-color: #b7b099;
    color: white;
  }
  .btn-edit:hover {
    opacity: 0.8;
  }
  .btn-delete {
    background-color: #c85a54;
    color: white;
  }
  .btn-delete:hover {
    opacity: 0.8;
  }
  /* ======================== */

  .empty-message {
    text-align: center;
    padding: 40px 20px;
    color: #999;
    font-size: 16px;
  }

  /* Header/profile/dropdown styles intentionally omitted here so
         the global header in base.html keeps its styles unchanged. */
</style>
<div class="list-page">
  <div class="container">
    <h1>Productos Essenza</h1>
    <div class="header-actions">
      <a href="{% url 'product_create' %}" class="btn-create">
        Crear producto</a
      >
    </div>

    <!-- FILTROS: categoría + marca -->
    <div class="filters">
      <div class="custom-dropdown" id="categoryDropdownList">
        <div class="dropdown-button" id="categoryButtonList">
          <span id="categorySelectedList">Todas las categorías</span>
          <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
        <div class="dropdown-menu" id="categoryMenuList">
          <div class="dropdown-item selected" data-value="all">
            <span>Todas las categorías</span>
            <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
        </div>
      </div>

      <div class="custom-dropdown" id="brandDropdownList">
        <div class="dropdown-button" id="brandButtonList">
          <span id="brandSelectedList">Todas las marcas</span>
          <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
        <div class="dropdown-menu" id="brandMenuList">
          <div class="dropdown-item selected" data-value="all">
            <span>Todas las marcas</span>
            <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
        </div>
      </div>
    </div>

    {% if products %}
    <div class="products-grid">
      {% for product in products %}
      <div class="product-card" data-category="{{ product.category }}" data-brand="{{ product.brand|default:''|lower }}">
        <div class="product-image">
          {% if product.photo %}
          <img src="{{ product.photo.url }}" alt="{{ product.name }}" />
          {% else %}
          <span>Sin imagen</span>
          {% endif %}
        </div>
        <div class="product-info">
          <div class="product-name">{{ product.name }}</div>
          <div class="product-brand">{{ product.brand }}</div>
          <div class="product-price">€ {{ product.price }}</div>
          <div class="product-actions">
            <a
              href="{% url 'product_detail' product.pk %}"
              class="btn-small btn-detail"
              >Ver</a
            >
            <a
              href="{% url 'product_update' product.pk %}"
              class="btn-small btn-edit"
              >Editar</a
            >
            <a
              href="{% url 'product_delete' product.pk %}"
              class="btn-small btn-delete"
              >Borrar</a
            >
          </div>
          <div class="product-stock">
            {% if product.stock == 0 %}
              <span style="color: #dc3545">Producto agotado</span>
            {% endif %} {% if product.stock < 10 and product.stock > 0 %}
            <span style="color: #fd7e14">Últimas unidades</span>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-message">
      <p>
        No hay productos disponibles.
        <a href="{% url 'product_create' %}">¡Crea uno!</a>
      </p>
    </div>
    {% endif %}
    <script>
      // Custom dropdown para list.html
      (function(){
        const categoryButton = document.getElementById('categoryButtonList');
        const categoryMenu = document.getElementById('categoryMenuList');
        const categorySelected = document.getElementById('categorySelectedList');
        const brandButton = document.getElementById('brandButtonList');
        const brandMenu = document.getElementById('brandMenuList');
        const brandSelected = document.getElementById('brandSelectedList');
        const cards = Array.from(document.querySelectorAll('.product-card'));

        // Toggle dropdowns
        categoryButton.addEventListener('click', (e) => {
          e.stopPropagation();
          categoryMenu.classList.toggle('show');
          brandMenu.classList.remove('show');
        });

        brandButton.addEventListener('click', (e) => {
          e.stopPropagation();
          brandMenu.classList.toggle('show');
          categoryMenu.classList.remove('show');
        });

        document.addEventListener('click', () => {
          categoryMenu.classList.remove('show');
          brandMenu.classList.remove('show');
        });

        // Poblar categorías dinámicamente
        function populateCategories() {
          const categories = new Set();
          cards.forEach(c => {
            const b = (c.dataset.category || '').trim();
            if (b) categories.add(b);
          });

          const sortedCategories = Array.from(categories).sort();
          sortedCategories.forEach(b => {
            const item = document.createElement('div');
            item.className = 'dropdown-item';
            item.dataset.value = b;
            item.innerHTML = `
              <span>${b.charAt(0).toUpperCase() + b.slice(1)}</span>
              <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
            `;
            categoryMenu.appendChild(item);
          });
        }
        populateCategories();

        // Poblar marcas dinámicamente
        function populateBrands() {
          const brands = new Set();
          cards.forEach(c => {
            const b = (c.dataset.brand || '').trim();
            if (b) brands.add(b);
          });

          const sortedBrands = Array.from(brands).sort();
          sortedBrands.forEach(b => {
            const item = document.createElement('div');
            item.className = 'dropdown-item';
            item.dataset.value = b;
            item.innerHTML = `
              <span>${b.charAt(0).toUpperCase() + b.slice(1)}</span>
              <svg class="check-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
            `;
            brandMenu.appendChild(item);
          });
        }
        populateBrands();

        // Manejar selección de categoría
        categoryMenu.addEventListener('click', (e) => {
          const item = e.target.closest('.dropdown-item');
          if (!item) return;

          categoryMenu.querySelectorAll('.dropdown-item').forEach(i => i.classList.remove('selected'));
          item.classList.add('selected');
          categorySelected.textContent = item.querySelector('span').textContent;
          categoryMenu.classList.remove('show');
          applyFilters();
        });

        // Manejar selección de marca
        brandMenu.addEventListener('click', (e) => {
          const item = e.target.closest('.dropdown-item');
          if (!item) return;

          brandMenu.querySelectorAll('.dropdown-item').forEach(i => i.classList.remove('selected'));
          item.classList.add('selected');
          brandSelected.textContent = item.querySelector('span').textContent;
          brandMenu.classList.remove('show');
          applyFilters();
        });

        // Aplicar filtros
        function applyFilters() {
          const catSelected = categoryMenu.querySelector('.dropdown-item.selected');
          const brandSelItem = brandMenu.querySelector('.dropdown-item.selected');
          const cat = catSelected ? catSelected.dataset.value : 'all';
          const brand = brandSelItem ? brandSelItem.dataset.value : 'all';

          cards.forEach(c => {
            const matchCat = cat === 'all' || (c.dataset.category || '') === cat;
            const matchBrand = brand === 'all' || (c.dataset.brand || '') === brand;
            c.style.display = (matchCat && matchBrand) ? '' : 'none';
          });
        }
      })();
    </script>
  </div>
</div>
{% endblock %}
